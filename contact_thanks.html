<!doctype html>
<html lang="ja">
<head>
  <script>(async(d,u)=>{try{const r=await fetch(u,{cache:'no-cache'}),h=await r.text(),tpl=d.createElement('template');tpl.innerHTML=h;[...tpl.content.childNodes].forEach(n=>{if(n.tagName==='SCRIPT'){const s=d.createElement('script');[...n.attributes].forEach(a=>s.setAttribute(a.name,a.value));s.textContent=n.textContent;d.head.appendChild(s);}else{d.head.appendChild(n);}});}catch(e){console.error('head include failed:',u,e);}})(document,'/includes/head-common.html');</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>送信完了 | お問い合わせ | ADDEVA® 公式</title>
  <meta name="description" content="お問い合わせの送信が完了しました。自動返信メールをご確認ください。">
  <meta name="robots" content="noindex,follow">

  <link rel="icon" href="favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/main.css?v=3.5">

  <meta property="og:type" content="website">
  <meta property="og:title" content="送信完了 | お問い合わせ | ADDEVA">
  <meta property="og:description" content="お問い合わせの送信が完了しました。自動返信メールをご確認ください。">
  <meta property="og:url" content="/contact_thanks.html">

  <style>
    .page-hero{padding:64px 0 24px;}
    .note{font-size:.95rem;}
  </style>
</head>
<body>
  <!-- 共通ヘッダー（include は維持） -->
  <div data-include="/includes/header.html" aria-busy="true"></div>

  <main>
    <section class="page-hero">
      <div class="container container-narrow">
        <div class="kicker">Contact</div>
        <h1 class="h2 mb-0">送信が完了しました</h1>
      </div>
    </section>

    <section class="section">
      <div class="container container-narrow">

        <div class="card shadow-sm" aria-live="polite">
          <div class="card-body p-4">
            <p class="mb-3 note text-muted">
              お問い合わせを受け付けました。送信控え（自動返信メール）が届いているか必ずご確認ください（迷惑メールフォルダもご確認ください）。<br>
              お返事には、最大<strong>3日</strong>ほどいただく場合があります。
            </p>

            <div class="mb-2">
              受付番号：<strong id="ticketText">-</strong>
            </div>

            <div class="border rounded p-3 bg-light" id="summaryBox">
              <div class="text-muted small">送信内容は、自動返信メール（送信控え）でご確認ください。</div>
            </div>$1

            <div class="mt-3 small text-muted">
              関連：<a href="/privacy-policy.html">プライバシーポリシー</a> / <a href="/terms.html">利用規約</a>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <p class="mb-2 text-muted small">自動返信メールが届かない場合は、メールでも受け付けています。</p>
          <a class="btn btn-outline-dark"
             href="mailto:contact@addeva.jp?subject=%E3%81%8A%E5%95%8F%E3%81%84%E5%90%88%E3%82%8F%E3%81%9B%EF%BC%88ADDEVA%EF%BC%89">
            メールアプリを開く
          </a>
          <p class="mt-2 mb-0">
            送信先：<a href="mailto:contact@addeva.jp">contact@addeva.jp</a>
          </p>
        </div>

      </div>
    </section>
  </main>

  <!-- 共通フッター（include は維持） -->
  <div data-include="/includes/footer.html" aria-busy="true"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/common.js?v=1.0.0"></script>

  <script>
    (async function () {
      // header/footer 読み込み
      const nodes = document.querySelectorAll('[data-include]');
      await Promise.all([...nodes].map(async el => {
        const f = el.getAttribute('data-include');
        const r = await fetch(f, {cache:'no-cache'});
        el.outerHTML = await r.text();
      }));

      // フッターの年号更新がある場合
      const y = document.getElementById('y');
      if (y) y.textContent = new Date().getFullYear();

      const LS_LAST = 'addeva_contact_last';

      function escHtml(s) {
        return String(s || '').replace(/[&<>"']/g, (c) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
      }

      function getTicketFromQuery() {
        try {
          const q = new URLSearchParams(location.search);
          return (q.get('ticket') || '').trim();
        } catch (_e) {
          return '';
        }
      }

      function clearTicketParam() {
        try {
          const u = new URL(location.href);
          u.searchParams.delete('ticket');
          history.replaceState({}, '', u.pathname);
        } catch (_e) { /* no-op */ }
      }

      function loadLast() {
        try {
          const raw = sessionStorage.getItem(LS_LAST);
          if (!raw) return null;
          return JSON.parse(raw);
        } catch (_e) {
          return null;
        }
      }

      function render(ticket, payload) {
        const ticketEl = document.getElementById('ticketText');
        if (ticketEl) ticketEl.textContent = ticket || '-';

        const box = document.getElementById('summaryBox');
        if (!box) return;

        if (!payload || (!payload.name && !payload.email && !payload.subject && !payload.message)) {
          box.innerHTML = '<div class="text-muted small">送信内容は、自動返信メール（送信控え）でご確認ください。</div>';
          return;
        }

        const p = payload;
        const lines = [];
        lines.push('<div class="small text-muted mb-2">送信内容</div>');
        if (p.name)   lines.push(`<div class="mb-1"><strong>お名前</strong>：${escHtml(p.name)}</div>`);
        if (p.email)  lines.push(`<div class="mb-1"><strong>メール</strong>：${escHtml(p.email)}</div>`);
        if (p.phone)  lines.push(`<div class="mb-1"><strong>電話番号</strong>：${escHtml(p.phone)}</div>`);
        if (p.call_time) lines.push(`<div class="mb-1"><strong>ご連絡可能な時間帯</strong>：${escHtml(p.call_time)}</div>`);
        if (p.order_id)  lines.push(`<div class="mb-1"><strong>ご注文番号</strong>：${escHtml(p.order_id)}</div>`);
        if (p.subject)   lines.push(`<div class="mb-2"><strong>件名</strong>：${escHtml(p.subject)}</div>`);
        if (p.message)   lines.push(`<div class="mt-2"><strong>お問い合わせ内容</strong><div class="mt-1" style="white-space:pre-wrap;">${escHtml(p.message)}</div></div>`);

        box.innerHTML = lines.join('');
      }

      // 初期化
      const ticket = getTicketFromQuery();
      const last = loadLast();

      // ticket がURLにあり、sessionStorage の ticket と一致するならその内容を表示
      // 一致しない/無い場合は、ticket表示はしつつ内容は「メールで確認」案内に倒す
      if (last && typeof last === 'object') {
        const lastTicket = String(last.ticket || '');
        const payload = last.payload || null;

        if (ticket && lastTicket && ticket === lastTicket) {
          render(ticket, payload);
        } else if (!ticket && lastTicket) {
          render(lastTicket, payload);
        } else {
          render(ticket || '-', null);
        }
      } else {
        render(ticket || '-', null);
      }

      // 画面表示後にURLから ticket を除去（共有・参照漏れ対策）
      if (ticket) clearTicketParam();
    })();
  </script>
</body>
</html>
